{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Construction Entry (revised)",
  "description": "A grammatical construction in Construction Grammar (CxG)",
  "type": "object",
  "required": ["id", "pattern", "name", "meanings"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for the construction",
      "pattern": "^[a-z-]+[0-9]{3}$",
      "minLength": 1
    },
    "name": {
      "type": "string",
      "description": "Human-readable name for the construction",
      "minLength": 1
    },
    "pattern": {
      "type": "string",
      "description": "Formal syntactic/morphological pattern",
      "minLength": 1
    },
    "type": {
      "type": "string",
      "description": "Domain providing maximal projectability for this cluster â€“ where knowing category membership supports the most reliable predictions. Not an ontological claim about what the entry 'is made of.'",
      "enum": [
        "syntactic",
        "semantic",
        "morphological",
        "phonological",
        "mixed"
      ]
    },

    "meanings": {
      "type": "object",
      "description": "Numbered meanings, keyed by integer strings",
      "minProperties": 1,
      "patternProperties": {
        "^[0-9]+$": {
          "type": "object",
          "oneOf": [
            {
              "required": ["definition", "examples"],
              "properties": {
                "definition": {
                  "type": "string",
                  "minLength": 1
                },
                "details": {
                  "type": "string",
                  "minLength": 1
                },
                "examples": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["form"],
                    "properties": {
                      "form": {
                        "type": "string",
                        "minLength": 1
                      },
                      "note": {
                        "type": "string",
                        "minLength": 1
                      }
                    }
                  }
                },
                "relations": {
                  "type": "array",
                  "description": "Indices referencing items in top-level 'relations'",
                  "items": {
                    "type": "integer"
                  }
                }
              },
              "additionalProperties": false
            },
            {
              "required": ["implements", "specialization", "examples"],
              "properties": {
                "implements": {
                  "type": "string",
                  "description": "Reference to meaning in another construction (format: construction-id.meaning-number)",
                  "pattern": "^[a-z-]+[0-9]{3}\\.[0-9]+$",
                  "minLength": 1
                },
                "specialization": {
                  "type": "string",
                  "description": "How this construction implements the referenced meaning",
                  "minLength": 1
                },
                "examples": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["form"],
                    "properties": {
                      "form": {
                        "type": "string",
                        "minLength": 1
                      },
                      "note": {
                        "type": "string",
                        "minLength": 1
                      }
                    }
                  }
                },
                "relations": {
                  "type": "array",
                  "description": "Indices referencing items in top-level 'relations'",
                  "items": {
                    "type": "integer"
                  }
                }
              },
              "additionalProperties": false
            }
          ]
        }
      },
      "additionalProperties": false
    },

    "relations": {
      "type": "object",
      "description": "Numbered relations, keyed by integer strings",
      "patternProperties": {
        "^[0-9]+$": {
          "type": "object",
          "required": ["construction", "type"],
          "properties": {
            "construction": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "description": "Relationship type",
              "enum": [
                "can-manifest-as",
                "often-contains",
                "overlaps-with",
                "can-contain",
                "inherits-from",
                "similar-to",
                "related-to",
                "transformed-from",
                "specialization-of",
                "implements",
                "see-also"
              ]
            },
            "notes": {
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "constraints": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["type", "description"],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "syntactic",
              "morphological",
              "semantic",
              "pragmatic",
              "structural",
              "head",
              "position"
            ]
          },
          "description": {
            "type": "string"
          }
        }
      }
    },

    "semanticType": {
      "type": "string",
      "enum": [
        "reference",
        "predication",
        "modification",
        "quantification"
      ]
    },

    "relatedConstructions": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "relationship"],
        "properties": {
          "id": {
            "type": "string"
          },
          "relationship": {
            "type": "string",
            "enum": [
              "alternates-with",
              "contains",
              "inherits-from",
              "similar-to",
              "related-to",
              "transformed-from",
              "specialization-of",
              "implements",
              "see-also"
            ]
          },
          "notes": {
            "type": "string"
          }
        }
      }
    },

    "semanticRefs": {
      "type": "array",
      "description": "References to entries in data/indices/semantic-features.yaml",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },

    "formRefs": {
      "type": "array",
      "description": "References to entries in data/indices/form-features.yaml",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },

    "syntacticRefs": {
      "type": "array",
      "description": "References to entries in data/indices/syntactic-diagnostics.yaml",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },

    "hpc": {
      "type": "object",
      "description": "Homeostatic Property Cluster (HPC) metadata for mechanism-grounded categories",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["hpc", "thin", "fat", "negative", "uncertain"]
        },
        "cluster": {
          "type": "object",
          "properties": {
            "core": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["property"],
                "properties": {
                  "property": { "type": "string" },
                  "diagnostics": {
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "weight": {
                    "type": "string",
                    "enum": ["high", "medium", "low"]
                  }
                },
                "additionalProperties": false
              }
            },
            "peripheral": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["property"],
                "properties": {
                  "property": { "type": "string" },
                  "diagnostics": {
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "weight": {
                    "type": "string",
                    "enum": ["high", "medium", "low"]
                  }
                },
                "additionalProperties": false
              }
            }
          },
          "additionalProperties": false
        },
        "stabilisers": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "evidence"],
            "properties": {
              "type": {
                "type": "string",
                "minLength": 1
              },
              "evidence": { "type": "string" }
            },
            "additionalProperties": false
          }
        },
        "provisional": {
          "type": "boolean",
          "description": "Marks exploratory or draft HPC metadata"
        },
        "projectibility": {
          "type": "object",
          "properties": {
            "scope": { "type": "string" },
            "evidence": { "type": "string" },
            "confidence": {
              "type": "string",
              "enum": ["high", "medium", "low"]
            }
          },
          "additionalProperties": false
        },
        "homeostasis": {
          "type": "object",
          "properties": {
            "perturbations": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          "additionalProperties": false
        },
        "variation": {
          "type": "object",
          "properties": {
            "activation_states": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["context", "effect"],
                "properties": {
                  "context": { "type": "string" },
                  "effect": { "type": "string" }
                },
                "additionalProperties": false
              }
            },
            "speaker_variation": { "type": "string" }
          },
          "additionalProperties": false
        },
        "boundaries": {
          "type": "object",
          "properties": {
            "overlaps_with": {
              "type": "array",
              "items": { "type": "string" }
            },
            "known_boundary_items": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          "additionalProperties": false
        },
        "grain": {
          "type": "object",
          "properties": {
            "level": {
              "type": "string",
              "enum": ["micro", "meso", "macro"]
            },
            "parent_families": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          "additionalProperties": false
        },
        "coupling": {
          "type": "object",
          "properties": {
            "linked_cluster": { "type": "string" },
            "mechanism": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  }
}
